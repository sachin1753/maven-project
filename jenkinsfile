pipeline
{
	agent any
	stages
	{
		
		stage ('scm checkout')
		{
			steps
			{
				git branch: 'master', url: 'https://github.com/sachin1753/maven-project'
			}

		}
	

		stage ('compile source code')
		{
			steps
			{
				withMaven(jdk: 'javaJDK', maven: 'defaultMaven') {
				    sh 'mvn compile'
				}
			}

		}

		stage ('test source code')
		{
			steps
			{
				withMaven(jdk: 'javaJDK', maven: 'defaultMaven') {
				    sh 'mvn test'
				}
			}

		}

		stage ('buil my job')
		{
			steps
			{
				withMaven(jdk: 'javaJDK', maven: 'defaultMaven') {
				    sh 'mvn clean package'
				}
			}

		}
		
		stage ('tomcat dev deployment')
		{
			steps
			{
				sshagent(['deploytomcat']) {
					sh 'scp -o StrictHostKeyChecking=no */target/*.war ec2-user@172.31.88.54:/var/lib/tomcat/webapps'
				}
			}

		}


		stage ('jboss dev deployment')
		{
			steps
			{
				sshagent(['deployJboss']) {
				    sh 'scp -o StrictHostKeyChecking=no */target/*.war ec2-user@172.31.23.29:/opt/wildfly/standalone/deployments'
				}
			}

		}
		

	}
}
